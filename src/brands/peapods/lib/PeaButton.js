/**
 * Follow predefined Button v1.1
 */
import React from 'react';
import PropTypes from 'prop-types';
import cx from 'clsx';
import MuiButton from '@material-ui/core/Button';
import CircularProgress from '@material-ui/core/CircularProgress';
import Tooltip from '@material-ui/core/Tooltip';

import Icon from './PeaIcon';

const getLoaderSize = size => {
  if (size === 'small') return 16;
  if (size === 'big') return 28;
  if (size === 'large') return 36;
  return 20;
};

const injectColor = color => {
  if (
    color === 'inherit' ||
    color === 'primary' ||
    color === 'secondary' ||
    color === 'default'
  ) {
    return color;
  }
  return undefined;
};

const PeaButton = ({
  className,
  classes,
  color,
  inverted,
  loading,
  elongated,
  size,
  shape,
  compact,
  shadowless,
  labelExpanded,
  mobileFullWidth,
  icon,
  iconIsolated,
  iconProps,
  iconPosition,
  children,
  loaderProps,
  tooltip,
  ...props
}) => {
  const iconComponent =
    typeof icon === 'string' ? <Icon {...iconProps}>{icon}</Icon> : icon;
  const loaderSize = getLoaderSize(size);
  const renderChildren = () =>
    icon ? <span className={'MuiButton-span'}>{children}</span> : children;

  return (
    <Tooltip title={tooltip} arrow>
      <MuiButton
        classes={{
          root: cx('MuiButton-root', classes.root),
          label: cx(
            'MuiButton-label',
            iconIsolated && '-icon-isolated',
            classes.label,
          ),
          disabled: cx('MuiButton-disabled', classes.disabled),
        }}
        className={cx(
          className,
          inverted && '-inverted',
          loading && '-loading',
          elongated && '-elongated',
          color && `-color-${color}`,
          size && `-size-${size}`,
          shape && `-shape-${shape}`,
          labelExpanded && '-labelExpanded',
          mobileFullWidth && '-mobileFullWidth',
          shadowless && '-shadowless',
          compact && '-compact',
        )}
        color={injectColor(color)}
        {...props}
      >
        {loading && (
          <CircularProgress
            thickness={6}
            {...loaderProps}
            size={loaderSize}
            style={{
              marginLeft: -loaderSize / 2,
              marginTop: -loaderSize / 2,
            }}
            className={'MuiButton-loader'}
          />
        )}
        {icon && iconPosition === 'start' && iconComponent}
        {renderChildren()}
        {icon && iconPosition === 'end' && iconComponent}
      </MuiButton>
    </Tooltip>
  );
};

PeaButton.propTypes = {
  className: PropTypes.string,
  classes: PropTypes.shape({
    root: PropTypes.string,
    label: PropTypes.string,
    disabled: PropTypes.string,
  }),
  color: PropTypes.oneOf([
    'default',
    'inherit',
    'primary',
    'secondary',
    // custom
    'danger',
  ]),
  compact: PropTypes.bool,
  tooltip: PropTypes.string,
  inverted: PropTypes.bool,
  loading: PropTypes.bool,
  elongated: PropTypes.bool,
  labelExpanded: PropTypes.bool,
  mobileFullWidth: PropTypes.bool,
  shadowless: PropTypes.bool,
  size: PropTypes.oneOf(['small', '', 'big', 'large']),
  shape: PropTypes.oneOf(['', 'chubby', 'circular', 'square', 'rectangle']),
  children: PropTypes.node,
  icon: PropTypes.oneOfType([PropTypes.string, PropTypes.object]),
  iconIsolated: PropTypes.bool,
  iconPosition: PropTypes.oneOf(['start', 'end']),
  iconProps: PropTypes.shape({}),
  loaderProps: PropTypes.shape({}),
};

PeaButton.defaultProps = {
  className: '',
  classes: {},
  color: 'default',
  compact: false,
  tooltip: '',
  inverted: false,
  loading: false,
  elongated: false,
  labelExpanded: false,
  mobileFullWidth: false,
  shadowless: true,
  size: '',
  shape: 'chubby',
  icon: '',
  iconIsolated: false,
  iconPosition: 'start',
  iconProps: {},
  loaderProps: {},
  children: undefined,
};

PeaButton.metadata = {
  name: 'Pea Button',
};

PeaButton.codeSandbox = 'https://codesandbox.io/s/zljn06jmq4';

export default PeaButton;
